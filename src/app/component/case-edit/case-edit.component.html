<div>
  <h3 class="content-h3">分析器基本信息</h3>

  <div class="fldInput singleInput">
    <h4 class="content-h4">适用的纳税人类型：</h4>
    <p-selectButton [options]="selectTaxTypes" [(ngModel)]="analyzer.taxType"></p-selectButton>
  </div>

  <div class="fldInput singleInput">
    <h4 class="content-h4">分析器类型：</h4>
    <input type="text" pInputText class="basic-input" [(ngModel)]="analyzer.type" />
  </div>

  <div class="fldInput singleInput">
    <h4 class="content-h4">分析器名称：</h4>
    <input type="text" pInputText class="basic-input" [(ngModel)]="analyzer.name" />
  </div>
  <div class="fldInput singleInput">
    <h4 class="content-h4">分析器所需条件：</h4>
    <p-multiSelect [maxSelectedLabels]=4 selectedItemsLabel="已选 {0} 项" defaultLabel="请选取需要用到的条件" [options]="conditions"
      optionLabel="label" [(ngModel)]="analyzer.analyzerInputs" (onChange)="changeCondRequire($event)">
    </p-multiSelect>
  </div>
  <div class="fldInput singleInput">
    <h4 class="content-h4">分析器展示项：</h4>
    <p-multiSelect [maxSelectedLabels]=4 selectedItemsLabel="已选 {0} 项" defaultLabel="请选取需要展示的项" [options]="analyzerShow"
      [(ngModel)]="analyzer.analyzerShows">
    </p-multiSelect>
  </div>
  <div class="fldInput singleInput">
    <h4 class="content-h4">分析器上线：</h4>
    <p-inputSwitch [(ngModel)]="analyzer.online"></p-inputSwitch>
  </div>
  <h4 class=" content-h4">分析器适用场景 <i (click)="addApplyOn(analyzer.applyOn)" class="addBtn pi pi-plus-circle"></i></h4>
  <p-table [value]="analyzer.applyOn">
    <ng-template pTemplate="header">
      <tr>
        <th>字段名</th>
        <th>对应值</th>
        <th style="width: 5em;">操作</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-tree>
      <tr>
        <td>
          <p-dropdown [options]="conditionsRequired" placeholder="选择字段" [(ngModel)]="tree.input.title">
          </p-dropdown>
        </td>
        <td>
          <input type="text" pInputText [(ngModel)]="tree.input.value" />
        </td>
        <td style="text-align: center;">
          <button pButton type="button" class="ui-button-danger" icon="pi pi-trash"
            (click)="removeApplyOn(tree)"></button>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="3" style="text-align: center;">暂无</td>
      </tr>
    </ng-template>
  </p-table>

  <h3 class="content-h3">配置分析项 <i (click)="addConditionTab()" class="addBtn pi pi-plus-circle"></i>
  </h3>
  <div>
    <p-tabView [activeIndex]="selectedTabIdx" (onChange)="tabChange($event)" (onClose)="checkTabAfterClose($event)">
      <p-tabPanel headerStyleClass='tree-header' *ngFor="let treeItem of analyzer.tree;index as i"
        [header]="treeItem.title?treeItem.title:'未命名'" [closable]="analyzer.tree.length > 1">
        <div class="analyzerTable">
          <div class="fldInput">
            <h4 class="content-h4">标题:</h4>
            <input type="text" pInputText style="width: 26em;" [(ngModel)]="treeItem.title" />
          </div>
          <div class="fldInput">
            <h4 class="content-h4">分析项状态:</h4>
            <p-dropdown [options]="status" [(ngModel)]="treeItem.status"></p-dropdown>
          </div>

        </div>

        <h4 class="content-h4">条件项 <i (click)="addCondition(treeItem)" class="addBtn pi pi-plus-circle"></i>
          <a class="overlayPanel-link" (click)="op1.toggle($event)">特殊日期输入注意事项</a>
        </h4>
        <p-overlayPanel #op1>
          <h3>以下值须严格按照规定格式输入：</h3>
          <ul class="overlayPanel-ul">
            <li *ngFor="let item of specialDates">
              {{item.title}} 输入格式为 : {{item.val}} <a [cdkCopyToClipboard]="item.val" (click)="showTCMsg(op1)">复制</a>
            </li>
          </ul>
        </p-overlayPanel>

        <p-table [value]="treeItem.cond">
          <ng-template pTemplate="header">
            <tr>
              <th>字段名</th>
              <th>判断条件</th>
              <th>判断值</th>
              <th style="width: 5em;">操作</th>
            </tr>

          </ng-template>

          <ng-template pTemplate="body" let-cond let-rowIndex="rowIndex">
            <tr>
              <td>
                <p-dropdown [options]="conditionsRequired" placeholder="选择字段" [(ngModel)]="cond.input.title">
                </p-dropdown>
              </td>
              <td>
                <p-dropdown [options]="symbols" [(ngModel)]="cond.input.symbol"></p-dropdown>
              </td>
              <td>
                <input type="text" [placeholder]="cond.input.inputType===1?'允许填入数字或者不填':''" [pValidateOnly]=true
                  pInputText [pKeyFilter]="noSpecial" [(ngModel)]="cond.input.value" />
              </td>
              <td style="text-align: center;">
                <button pButton type="button" class="ui-button-danger" icon="pi pi-trash"
                  (click)="removeCondition(cond)"></button>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="4" style="text-align: center;">暂无</td>
            </tr>
          </ng-template>
        </p-table>

        <div class="fldInput fldInput-textarea">
          <h4 class="content-h4">建议摘要:</h4>
          <textarea class="normal-textarea" rows="4" cols="100" [(ngModel)]=" treeItem.summary"
            pInputTextarea></textarea>
        </div>
        <div class="fldInput fldInput-textarea">
          <h4 class="content-h4" style="width: 4.9em;">建议:</h4>
          <textarea [(ngModel)]="treeItem.advice" rows="8" cols="96" pInputTextarea
            style="width: 80%;max-width: 90em;min-height:12em; " autoResize="autoResize"></textarea>
        </div>
      </p-tabPanel>
    </p-tabView>
  </div>

</div>
<p-confirmDialog [style]="{width: '50vw'}" [baseZIndex]="10000"></p-confirmDialog>

<p-messages class="notification" [(value)]="messages"></p-messages>

<p-toast [style]="{marginTop: '80px'}" position="top-center" key="tc"></p-toast>